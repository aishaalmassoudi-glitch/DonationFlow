<!doctype html>
<html lang="ar">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>إنشاء حساب</title><link rel="stylesheet" href="styles.css"></head>
<body>
<div id="loader" class="loader">جارٍ المعالجة...</div>
<div class="container" style="max-width:450px; margin-top:50px;">
  <div class="card">
    <h2 style="text-align:center; margin-top:0;">إنشاء حساب جديد</h2>
<div class="form-row">
  <label for="username">اسم المستخدم</label>
  <input id="username" class="input" type="text" placeholder="أدخل اسم المستخدم">
</div>
<div class="form-row">
  <label for="password">كلمة المرور</label>
  <input id="password" type="password" class="input" placeholder="أدخل كلمة المرور">
</div>
<div class="form-row">
  <label for="role">نوع الحساب</label>
  <select id="role" class="input" title="اختر نوع الحساب">
    <option value="donor">موظف (متبرع)</option>
    <option value="admin">مسؤول</option>
  </select>
</div>
    <div style="margin-top:15px; display:flex; justify-content:flex-end;"><button id="registerBtn" class="btn btn-primary">إنشاء حساب</button></div>
    <hr><p style="text-align:center;">لديك حساب؟ <a href="login.html">تسجيل الدخول</a></p>
  </div>
</div>

<script>
function showMessage(text, type="success"){ const msg=document.createElement('div'); msg.className = type==='error' ? 'error' : 'success'; msg.innerText = text; document.body.prepend(msg); setTimeout(()=>msg.remove(), 3000); }
function showLoader(){ loader.style.display='block'; } function hideLoader(){ loader.style.display='none'; }

document.getElementById('registerBtn').addEventListener('click', async ()=> {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value;
  if(!username || !password) return showMessage('الرجاء تعبئة الحقول','error');
  showLoader();
  try {
    const res = await fetch('/api/register', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ username, password, role })});
    const data = await res.json();
    hideLoader();
    if(res.ok){ showMessage('تم إنشاء الحساب، سجّل الدخول الآن'); setTimeout(()=>location.href='login.html',700); } else showMessage(data.error||'فشل التسجيل','error');
  } catch(e){ hideLoader(); showMessage('خطأ في الاتصال','error'); }
});
</script>
</body>
</html>
