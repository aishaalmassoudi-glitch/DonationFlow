<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>تسجيل الدخول - DonationFlow</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
<div id="loader" class="loader">جارٍ الاتصال بالخادم...</div>
<div class="container" style="max-width:420px; margin-top:60px;">
  <div class="card">
    <h2 style="text-align:center; margin-top:0;">تسجيل الدخول</h2>
    <div class="form-row"><label>اسم المستخدم</label><input id="username" class="input" placeholder="مثال: admin"></div>
    <div class="form-row"><label>كلمة المرور</label><input id="password" type="password" class="input" placeholder="••••••••"></div>
    <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:12px;">
      <button id="loginBtn" class="btn btn-primary">دخول</button>
      <button class="btn btn-secondary" onclick="location.href='register.html'">إنشاء حساب</button>
    </div>
    <hr style="margin:20px 0; border:none; border-bottom:1px solid #d2e6ff;">
    <div style="text-align:center;"><button class="btn btn-secondary" onclick="location.href='dashboard.html'">تخطي (وصول للداشبورد)</button></div>
  </div>
</div>

<script>
function showMessage(text, type="success"){ const div=document.createElement('div'); div.className = type==='error' ? 'error' : 'success'; 
div.innerText = text; document.body.prepend(div); 
setTimeout(()=>div.remove(),3000); }
function showLoader(){ document.getElementById('loader').style.display = 'block'; }
function hideLoader(){ document.getElementById('loader').style.display = 'none'; }

document.getElementById("loginBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;
  if(!username || !password) { showMessage("الرجاء إدخال معلومات الدخول", "error"); return; }
  showLoader();
  try {
    const res = await fetch("/api/login", { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({ username, password }) });
    const data = await res.json();
    hideLoader();
    if(res.ok && data.token) {
      localStorage.setItem("token", data.token);
      localStorage.setItem("role", data.role || 'donor');
      localStorage.setItem("username", data.username || '');
      showMessage("تم تسجيل الدخول بنجاح");
      if(data.role === "admin") location.href = "/admin-dashboard.html"; else location.href = "/dashboard.html";
    } else {
      showMessage(data.error || "فشل تسجيل الدخول", "error");
    }
  } catch (e) {
    hideLoader();
    showMessage("خطأ في الاتصال بالخادم", "error");
    console.error(e);
  }
});
</script>
</body>
</html>
