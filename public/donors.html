<!doctype html><html lang="ar">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>المتبرعين</title><link rel="stylesheet" href="styles.css"></head>
<body>
<div id="loader" class="loader">جارِ التحميل...</div>
<script> if(!localStorage.getItem('token')) location.href='/login.html'; </script>
<div class="container">
  <div class="card"><div style="display:flex;justify-content:space-between"><h3>المتبرعين</h3><button class="btn btn-primary" onclick="location.href='/add-donor.html'">إضافة</button></div>
    <table class="table"><thead><tr><th>الاسم</th><th>الجوال</th><th>البريد</th><th>عدد التبرعات</th><th>إجراء</th></tr></thead><tbody id="tbody"><tr><td colspan="5">جارِ التحميل...</td></tr></tbody></table>
  </div>
</div>

<script>
function showMessage(t,type='success'){ const d=document.createElement('div'); d.className= type==='error'?'error':'success'; d.innerText=t; document.body.prepend(d); setTimeout(()=>d.remove(),3000); }
async function load(){ document.getElementById('loader').style.display='block'; try{ const res=await fetch('/api/donors',{ headers:{ 'Authorization':'Bearer '+localStorage.getItem('token') }}); 
const list=await res.json(); document.getElementById('loader').style.display='none'; const tbody=document.getElementById('tbody'); tbody.innerHTML=''; if(!list.length){ tbody.innerHTML='<tr><td colspan="5">لا يوجد متبرعين</td></tr>'; return; }
list.forEach(d=>tbody.innerHTML += `<tr><td>${d.name}</td><td>${d.phone}</td><td>${d.email||'-'}</td><td>${d.donationsCount||0}</td><td><button class="btn btn-danger" onclick="del('${d._id}')">حذف</button></td></tr>`); }catch(e){ console.error(e);
document.getElementById('loader').style.display='none'; showMessage('خطأ في التحميل','error'); } }
async function del(id){ if(!confirm('تأكيد الحذف؟')) return; const res=await fetch('/api/donors/'+id,{ method:'DELETE', headers:{ 'Authorization':'Bearer '+localStorage.getItem('token') }}); if(res.ok) load(); else showMessage('فشل الحذف','error'); }
load();
</script>
</body></html>
